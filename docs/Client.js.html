<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Client.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Base.html">Base</a><ul class='members'><li data-type='method'><a href="Base.html#raw">raw</a></li></ul></li><li><a href="Bot.html">Bot</a><ul class='methods'><li data-type='method'><a href="Bot.html#toString">toString</a></li></ul><ul class='members'><li data-type='method'><a href="Bot.html#approved">approved</a></li><li data-type='method'><a href="Bot.html#approvedTimestamp">approvedTimestamp</a></li><li data-type='method'><a href="Bot.html#avatar">avatar</a></li><li data-type='method'><a href="Bot.html#avatarURL">avatarURL</a></li><li data-type='method'><a href="Bot.html#backgroundColor">backgroundColor</a></li><li data-type='method'><a href="Bot.html#clientID">clientID</a></li><li data-type='method'><a href="Bot.html#discriminator">discriminator</a></li><li data-type='method'><a href="Bot.html#featured">featured</a></li><li data-type='method'><a href="Bot.html#github">github</a></li><li data-type='method'><a href="Bot.html#guildCount">guildCount</a></li><li data-type='method'><a href="Bot.html#id">id</a></li><li data-type='method'><a href="Bot.html#inviteNoPerms">inviteNoPerms</a></li><li data-type='method'><a href="Bot.html#inviteURL">inviteURL</a></li><li data-type='method'><a href="Bot.html#library">library</a></li><li data-type='method'><a href="Bot.html#ownerID">ownerID</a></li><li data-type='method'><a href="Bot.html#page">page</a></li><li data-type='method'><a href="Bot.html#prefix">prefix</a></li><li data-type='method'><a href="Bot.html#raw">raw</a></li><li data-type='method'><a href="Bot.html#secondaryOwnerIDs">secondaryOwnerIDs</a></li><li data-type='method'><a href="Bot.html#shortDescription">shortDescription</a></li><li data-type='method'><a href="Bot.html#supportCode">supportCode</a></li><li data-type='method'><a href="Bot.html#supportURL">supportURL</a></li><li data-type='method'><a href="Bot.html#tag">tag</a></li><li data-type='method'><a href="Bot.html#username">username</a></li><li data-type='method'><a href="Bot.html#vanityCode">vanityCode</a></li><li data-type='method'><a href="Bot.html#vanityURL">vanityURL</a></li><li data-type='method'><a href="Bot.html#verified">verified</a></li><li data-type='method'><a href="Bot.html#votes">votes</a></li><li data-type='method'><a href="Bot.html#websiteBot">websiteBot</a></li></ul></li><li><a href="Client.html">Client</a><ul class='methods'><li data-type='method'><a href="Client.html#fetchBot">fetchBot</a></li><li data-type='method'><a href="Client.html#fetchBotsOfUser">fetchBotsOfUser</a></li><li data-type='method'><a href="Client.html#fetchUpvotes">fetchUpvotes</a></li><li data-type='method'><a href="Client.html#fetchUser">fetchUser</a></li><li data-type='method'><a href="Client.html#postCount">postCount</a></li></ul><ul class='members'><li data-type='method'><a href="Client.html#bots">bots</a></li><li data-type='method'><a href="Client.html#options">options</a></li><li data-type='method'><a href="Client.html#users">users</a></li></ul></li><li><a href="FetchError.html">FetchError</a></li><li><a href="User.html">User</a><ul class='methods'><li data-type='method'><a href="User.html#toString">toString</a></li></ul><ul class='members'><li data-type='method'><a href="User.html#avatar">avatar</a></li><li data-type='method'><a href="User.html#avatarURL">avatarURL</a></li><li data-type='method'><a href="User.html#background">background</a></li><li data-type='method'><a href="User.html#biography">biography</a></li><li data-type='method'><a href="User.html#discriminator">discriminator</a></li><li data-type='method'><a href="User.html#id">id</a></li><li data-type='method'><a href="User.html#page">page</a></li><li data-type='method'><a href="User.html#positions">positions</a></li><li data-type='method'><a href="User.html#raw">raw</a></li><li data-type='method'><a href="User.html#tag">tag</a></li><li data-type='method'><a href="User.html#username">username</a></li><li data-type='method'><a href="User.html#website">website</a></li></ul></li><li><a href="VoteContents.html">VoteContents</a><ul class='members'><li data-type='method'><a href="VoteContents.html#raw">raw</a></li><li data-type='method'><a href="VoteContents.html#recipientID">recipientID</a></li><li data-type='method'><a href="VoteContents.html#voters">voters</a></li><li data-type='method'><a href="VoteContents.html#voters24Hours">voters24Hours</a></li><li data-type='method'><a href="VoteContents.html#votes">votes</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">Client.js</h1>
    
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Bot = require('./structures/Bot.js');
const User = require('./structures/User.js');
const VoteContents = require('./structures/VoteContents.js');
const FetchError = require('./structures/FetchError.js');
const { ClientOpts, FetchOpts, PostOpts } = require('./structures/options.js');

const check = require('./util/check.js');
const Store = require('@ired_me/red-store');
const Fetch = require('node-fetch').default;
const endpoint = 'https://botsfordiscord.com/api';

const isObject = (o) => Array.isArray(o) ? false : o === Object(o);

class Client {
	/**
	 * @param {ClientOptions} opts
	 */
	constructor(opts = ClientOpts) {
		/**
		 * The ClientOptions of the Client.
		 * @type {ClientOptions}
		 */
		this.options = opts;
		this.edit(opts, true);

		/**
		 * Cached bots, mapped by their ID.
		 * @type {Store}
		 */
		this.bots = new Store();

		/**
		 * Cached users, mapped by their ID.
		 * @type {Store}
		 */
		this.users = new Store();
	}

	get endpoint() {
		return endpoint;
	}

	async get(point, ...headers) {
		const i = await Fetch(this.endpoint + point + headers.join(''));
		const contents = await i.json();
		if (contents.message) throw new FetchError(i, contents.message);
		else return contents;
	}

	async authGet(point, Authorization, ...headers) {
		const i = await Fetch(this.endpoint + point + headers.join(''), { headers: { Authorization } });
		const contents = await i.json();
		if (contents.message) throw new FetchError(i, contents.message);
		else return contents;
	}

	async post(point, Authorization, body) {
		const i = await Fetch(this.endpoint + point, {
			method: 'post',
			headers: { Authorization, 'Content-Type': 'application/json' },
			body: JSON.stringify(body),
		});

		const contents = await i.json();
		if (contents.message) throw new FetchError(i, contents.message);
		else return contents;
	}

	edit(options, preset = false) {
		const use = preset ? ClientOpts : this.options;
		const o = check(Object.assign(use, options));

		FetchOpts.cache = o.cache;
		FetchOpts.botToken = PostOpts.botToken = o.botToken;

		return this.options = o;
	}

	/**
	 * Fetches a bot that is listed on Bots for Discord.
	 * @param {string} [id=this.options.botID] The Discord ID of a bot to fetch from.
	 * @param {FetchOptions} [options={}] Options to pass.
	 * @returns {Bot}
	 */
	async fetchBot(id = this.options.botID, options = {}) {
		if (isObject(id)) {
			options = id;
			id = this.options.botID;
		}
		const { cache, raw } = Object.assign(FetchOpts, options); // eslint-disable-line

		if (id === null || typeof id === 'undefined') throw new ReferenceError('id must be defined.');
		if (typeof id !== 'string') throw new TypeError('id must be a string.');
		if (!isObject(options)) throw new TypeError('options must be an object.');

		const contents = await this.get(`/bot/${id}`);
		if (cache) this.bots.set(id, new Bot(contents));
		return raw ? contents : new Bot(contents);
	}

	/**
	 * Fetches the bot IDs of a user.
	 * @param {string} id The Discord ID of a user to fetch owned bot IDs from.
	 * @returns {string[]}
	 */
	async fetchBotsOfUser(id) {
		if (typeof id === 'undefined' || id === null) throw new ReferenceError('id must be defined.');
		if (typeof id !== 'string') throw new TypeError('id must be a string.');

		const contents = await this.get(`/user/${id}/bots`);
		if (!Array.isArray(contents.bots)) return [];
		else return contents.bots;
	}

	/**
	 * Fetches a Bot's Upvotes.
	 * @param {string} [id=this.options.botID] The Discord ID of a bot to fetch votes from.
	 * @param {string} [botToken=this.options.botToken] The bot's API token from Bots for Discord.
	 * @returns {VoteContents}
	 */
	async fetchUpvotes(id = this.options.botID, botToken = this.options.botToken) {
		if (typeof id === 'undefined' || id === null) throw new ReferenceError('id must be defined.');
		if (typeof id !== 'string') throw new TypeError('id must be a string.');
		if (typeof botToken === 'undefined' || botToken === null) throw new ReferenceError('botToken must be defined.');
		if (typeof botToken !== 'string') throw new TypeError('botToken must be a string.');

		const contents = await this.authGet(`/bot/${id}/votes`, botToken);
		return new VoteContents(contents, id);
	}

	/**
	 * Fetches a user on Bots for Discord.
	 * @param {string} id The Discord ID of a user to fetch from.
	 * @param {FetchOptions} [options={}] Options to pass.
	 * @returns {User}
	 */
	async fetchUser(id, options = {}) {
		const { cache, raw } = Object.assign(FetchOpts, options);

		if (typeof id === 'undefined') throw new ReferenceError('id must be defined.');
		if (typeof id !== 'string') throw new TypeError('id must be a string.');
		if (!isObject(options)) throw new TypeError('options must be an object.');

		const contents = await this.get(`/user/${id}`);
		if (cache) this.users.set(id, new User(contents));
		return raw ? contents : new User(contents);
	}

	/**
	 * Posts guild count for a bot.
	 * @param {string | number | PostOptions} [id=this.options.botID] The ID of the Bot to post guild count of.
	 * * This can also be {@link PostOptions} if `this.options.botID` is defined.
	 * * This can also be a number for {@link PostOptions#guildCount} (Overrides options#guildCount if so.)
	 * @param {PostOptions | number} [options={}] Options to pass.
	 * * This can also be a number for {@link PostOptions#guildCount} (Requires `this.options.botToken` be present)
	 * @returns {object}
	 */
	async postCount(id = this.options.botID, options = {}) {
		if (isObject(id)) {
			options = id;
			id = this.options.botID;
		}
		if (typeof id === 'number') {
			options.guildCount = id;
			id = this.options.botID;
		}
		if (typeof options === 'number') {
			options = { guildCount: options };
		}
		const { botToken, guildCount } = Object.assign(PostOpts, options);

		if (typeof id === 'undefined' || id === null) throw new ReferenceError('id must be defined.');
		if (typeof id !== 'string') throw new TypeError('id must be a string or a number.');
		if (!botToken) throw new ReferenceError('options.botToken must be present.');
		if (!guildCount) throw new ReferenceError('options.guildCount must be present.');

		return await this.post(`/bot/${id}`, botToken, { server_count: guildCount });
	}
}

module.exports = Client;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Jan 19 2019 21:15:21 GMT-0800 (Pacific Standard Time) using the Toast theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
